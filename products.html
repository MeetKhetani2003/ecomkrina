<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width-device-width, initial-scale=1.0">
    <title>All Products - Redstore</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700&display=swap"
        rel="stylesheet">
    <!--added a cdn link by searching font awesome4 cdn and getting this link from https://www.bootstrapcdn.com/fontawesome/ this url*/-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

</head>

<body>
    <!--<div class ="header">-->
    <div class="container">
        <div class="navbar">
            <div class="logo">
                <a href="index.html"><img src="images/logo.png" width="125px"></a>
            </div>
            <nav>
                <ul id="MenuItems">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="products.html">Products</a></li>
                    <li><a href="About.html">About</a></li>
                    <li><a href="contact.html">Contact</a></li>
                    <li><a href="account.html">Account</a></li>

                </ul>
            </nav>
            <a href="cart.html"><img src="images/cart.png" width="30px" height="30px"></a>
            <img src="images/menu.png" class="menu-icon" onClick="menutoggle()">
        </div>

    </div>
    <!--</div>-->


   <div class="small-container">
  <div class="row" id="productList"></div>
</div>



    <!----------------------------------footer------------------------------------->
    <div class="footer">
        <div class="container" style="text-align:center;">
            <div class="footer-col-2">
                <img src="images/logo-white.png" alt="Logo" style="max-width:160px;">
                <p>Our Purpose Is To Sustainably Make the Pleasure and Benefits of Sports Accessible to the Many.</p>
            </div>




            <!-----------------------------------js for toggle menu-------------------------------------->
            <script>
                var menuItems = document.getElementById("MenuItems");

                MenuItems.style.maxHeight = "0px";
                function menutoggle() {
                    if (MenuItems.style.maxHeight == "0px") {
                        MenuItems.style.maxHeight = "200px";
                    }
                    else {
                        MenuItems.style.maxHeight = "0px";
                    }
                }
            </script>
<script>
function generateStars(rating) {
    let starsHTML = "";
    rating = parseInt(rating) || 0;

    for (let i = 1; i <= 5; i++) {
        if (i <= rating) {
            starsHTML += '<i class="fa fa-star"></i>';
        } else {
            starsHTML += '<i class="fa fa-star-o"></i>';
        }
    }

    return starsHTML;
}

document.addEventListener("DOMContentLoaded", async () => {

    const container = document.getElementById("productList");

    try {
        const res = await fetch("/api/products");
        const products = await res.json();

        let html = "";

        products.forEach(product => {
            html += `
                <div class="col-4 product-card">
                    <div onclick="goToProduct(${product.id})" style="cursor:pointer">
                        <img src="${product.image}" alt="${product.title}">
                        <h4>${product.title}</h4>
                        <div class="rating">
                            ${generateStars(product.Rating)}
                        </div>
                        <p>$${product.price}</p>
                    </div>

                    <button class="btn add-btn"
                        onclick="addToCart(event, ${product.id})">
                        Add to Cart
                    </button>
                </div>
            `;
        });

        container.innerHTML = html;

    } catch (error) {
        console.error("Error loading products:", error);
    }
});

function goToProduct(id) {
    window.location.href = "product-details.html?id=" + id;
}

async function addToCart(event, productId) {

    event.stopPropagation();

    try {
        const response = await fetch("/api/cart", {
            method: "POST",
            credentials: "include",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                product_id: productId,
                quantity: 1
            })
        });

        if (!response.ok) {
            alert("Please login first");
            window.location.href = "account.html";
            return;
        }

        alert("Added to cart successfully!");

    } catch (err) {
        console.error(err);
        alert("Error adding to cart");
    }
}
</script>

</body>

</html>