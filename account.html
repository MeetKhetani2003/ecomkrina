<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Account - Redstore</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
    />
  </head>

  <body>
    <div class="container">
      <div class="navbar">
        <div class="logo">
          <a href="index.html"><img src="images/logo.png" width="125px" /></a>
        </div>
        <nav>
          <ul id="MenuItems">
            <li><a href="index.html">Home</a></li>
            <li><a href="products.html">Products</a></li>
            <li><a href="About.html">About</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="wishlist.html">Wishlist</a></li>
                        <li><a href="profile.html">Profile</a></li>

            <li><a href="account.html">Account</a></li>
          </ul>
        </nav>
        <div class="nav-icons">
          <a href="wishlist.html" title="Wishlist"><i class="fa fa-heart-o"></i></a>
          <a href="profile.html" title="Profile"><i class="fa fa-user"></i></a>
          <a href="cart.html" title="Cart"><i class="fa fa-shopping-cart"></i></a>
        </div>
      </div>
    </div>

    <!-- Account Page -->
    <div class="account-page">
      <div class="container">
        <div class="row">
          <div class="col-2">
            <img src="images/image1.png" width="100%" />
          </div>

          <div class="col-2">
            <div class="form-container">
              <div class="form-btn">
                <span onclick="showRegister()">Register</span>
                <span onclick="showLogin()">Login</span>
                <hr id="Indicator" />
              </div>

              <!-- LOGIN FORM -->
              <form id="loginForm">
                <input
                  type="email"
                  id="loginEmail"
                  placeholder="Email"
                  required
                />
                <input
                  type="password"
                  id="loginPassword"
                  placeholder="Password"
                  required
                />
                <button type="submit" class="btn">Login</button>
              </form>

              <!-- REGISTER FORM -->
              <form id="registerForm">
                <input
                  type="text"
                  id="registerName"
                  placeholder="Name"
                  required
                />
                <input
                  type="email"
                  id="registerEmail"
                  placeholder="Email"
                  required
                />
                <input
                  type="password"
                  id="registerPassword"
                  placeholder="Password"
                  required
                />
                <button type="submit" class="btn">Register</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toggle Script -->
    <script>
      const loginForm = document.getElementById("loginForm");
      const registerForm = document.getElementById("registerForm");
      const indicator = document.getElementById("Indicator");

      function showLogin() {
        loginForm.style.display = "block";
        registerForm.style.display = "none";
        indicator.style.transform = "translateX(100px)";
      }

      function showRegister() {
        loginForm.style.display = "none";
        registerForm.style.display = "block";
        indicator.style.transform = "translateX(0px)";
      }

      // Default view
      showLogin();
    </script>

    <!-- LOGIN LOGIC -->
    <script>
      loginForm.addEventListener("submit", async function (e) {
        e.preventDefault();

        const email = document.getElementById("loginEmail").value;
        const password = document.getElementById("loginPassword").value;

        try {
          const response = await fetch("/api/users/login", {
            method: "POST",
            credentials: "include",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password }),
          });

          const data = await response.json();

          if (response.ok) {
            localStorage.setItem("user", JSON.stringify(data.user));
            alert("Login successful!");
            window.location.href = "index.html";
          } else {
            alert(data.message || "Invalid credentials");
          }
        } catch (err) {
          alert("Server error");
        }
      });
    </script>

    <!-- REGISTER LOGIC -->
    <script>
      registerForm.addEventListener("submit", async function (e) {
        e.preventDefault();

        const name = document.getElementById("registerName").value;
        const email = document.getElementById("registerEmail").value;
        const password = document.getElementById("registerPassword").value;

        try {
          const response = await fetch("/api/users/register", {
            method: "POST",
            credentials: "include",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, email, password }),
          });

          const data = await response.json();

          if (response.ok) {
            alert("Registration successful! Please login.");
            showLogin();
          } else {
            alert(data.error || "Registration failed");
          }
        } catch (err) {
          alert("Server error");
        }
      });
    </script>
  </body>
</html>
